<!doctype html>
<html>
	<head>
		<title>Socket.IO chat</title>
	</head>
	<body>
		<form action="">
			<input id="user" autocomplete="off" />
			<input id="msg" autocomplete="off" />
			<button>Send</button>
		</form>
		<ul id="msgs"></ul>
	</body>
</html>
<!--[if IE]><script src="es5-shim.min.js"></script><![endif]-->
<script>
//if (typeof window.console === 'undefined')
//	window.console = {
//		log: function () {},
//		info: function () {},
//		warn: function () {},
//		error: function () {}};
</script>
<!--<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>-->
<script src="/socket.io/socket.io.js"></script>
<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
<script>
	var $user = $('#user');
	var $msg  = $('#msg');
	var $msgs = $('#msgs');
	var $form = $('form');
	var socket = io();
	$user.val(+new Date+Math.random());
	$form.submit(function(){
		socket.emit('chat message', {user: $user.val(), message: $msg.val()});
		$msg.val('');
		return false;
	});
	function addMsg(msg) {
		msg=JSON.stringify(msg);
		$msgs.append($('<li>').text(msg));
		if ($msgs.children().length > 10)
			$msgs.children().first().remove();
	}
	addMsg({client: 'connecting...'});
	socket.on('chat message', addMsg);
	socket.on('all messages', function(list) {
		// console.log('list: ' + list);
		$msgs.empty();
		list.forEach(addMsg);
	});
</script>
