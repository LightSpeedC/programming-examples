<!DOCTYPE html>
<html lang="ja">
<meta charset="UTF-8">
<meta http-equiv="Content-Language" content="ja">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge, Chrome=1">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Cache-Control" content="no-cache">
<meta http-equiv="Expires" content="Thu, 01 Dec 1994 16:00:00 GMT">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>console component - Mithril.js</title>

<script src="/js/mithril.min.js"></script>
<script src="/js/mithril.ie.polyfill.js"></script>


<body>
<div id="$elem1"></div>
<div id="$elem2"></div>
<div id="$elem3"></div>
</body>

<script>
var labelComponent = {
	controller: function (label) {
		this.label = label + ':';
	},
	view: function (ctrl) {
		return m('td', ctrl.label);
	}
};

//HTML要素のイベントと値にプロパティを接続するユーティリティ
function makeAttrsOn(onEventName, propName, propFunc, attrs) {
	attrs = attrs || {};
	attrs[onEventName] = m.withAttr(propName, propFunc);
	attrs[propName] = propFunc();
	return attrs;
}

var textComponent = {
	controller: function (value) {
		this.value = m.prop(value);
	},
	view: function (ctrl) {
		return m('td', [m('input', makeAttrsOn('onchange', 'value', ctrl.value))]);
	}
};

var components = {
	controller: function (comps) {
		var ctrl = this;
		ctrl.children = comps.map(function (comp) {
			return {comp: comp, view: comp.view,
				ctrl: !comp.controller ? {} : new comp.controller()}
		});
	},
	view: function (ctrl) {
			return ctrl.children.map(function (child) {
				return child.view(child.ctrl); });
	}
};

var labelTextComponent = {
	controller: function (label, value) {
		var ctrl = this;
		ctrl.children = [
			m.component(labelComponent, label),
			m.component(textComponent, value)]
			.map(function (comp) {
				return {comp: comp, view: comp.view,
					ctrl: !comp.controller ? {} : new comp.controller()}
			});
	},
	view: function (ctrl) {
		return m('tr', [
			ctrl.children.map(function (child) {
				return child.view(child.ctrl); })
		]);
	}
};

var labelTextComponent2 = {
	controller: function (label, value) {
		var ctrl = this;
		ctrl.children = [
			m.component(labelComponent, label),
			m.component(textComponent, value)]
			.map(function (comp) {
				return {comp: comp, view: comp.view,
					ctrl: !comp.controller ? {} : new comp.controller()}
			});
	},
	view: function (ctrl) {
			return ctrl.children.map(function (child) {
				return child.view(child.ctrl); });
	}
};

var form1Component = {
	controller: function (label, value) {
		var ctrl = this;
		ctrl.children = [
			m.component(labelTextComponent, 'label333', 'value333'),
			m.component(labelTextComponent, 'label44444', 'value44444')]
			.map(function (comp) {
				return {comp: comp, view: comp.view,
					ctrl: !comp.controller ? {} : new comp.controller()}
			});
	},
	view: function (ctrl) {
		return m('table', {border: 0, bgcolor: '#ddffdd'}, [
			ctrl.children.map(function (child) {
				return child.view(child.ctrl); })
		]);
	}
};

//m.mount($elem1, m.component(labelTextComponent, 'label1', 'value1'));
//m.mount($elem2, m.component(labelTextComponent, 'label2', 'value2'));
m.mount($elem3, form1Component);

</script>

