<!DOCTYPE html>
<meta charset="UTF-8">
<title>Mithril.js print</title>

<script src="/js/mithril.min.js"></script>

<div id="counter-app"></div>

<div id="console-app"></div>

<script>

var ConsoleApp = {
	controller: function () {
		var ctrl = this;
		ctrl.list = [];
		ctrl.push = function (msg) {
			ctrl.list.push({key:Date.now()+':'+Math.random(), msg:msg});
			if (ctrl.list.length > 10) ctrl.list.shift();
		};

		window.console = function (console) {
			var c = {};
			for (var p in console)
				if (typeof console[p] === 'function')
					c[p] = function (p, f) {
						return function () {
							f.apply(console, arguments);
							ctrl.push(p + ': ' + [].slice.call(arguments).join(' '));
							m.redraw(true);
						}
					}(p, console[p]);
			return c;
		} (console);

		console.log('console.log used');
	},
	view: function (ctrl) {
		return m('pre', [
			ctrl.list.map(function (item) {
				return m('div', {key:item.key}, item.msg);
			})
		]);
	}
};

m.mount(document.getElementById("console-app"), ConsoleApp);

var CounterApp = {
	controller: function () {
		var ctrl = this;
		ctrl.counter = 0;
		setInterval(function () {
			ctrl.counter++;
			console.log('counter: ' + ctrl.counter);
			m.redraw(true);
		}, 1000);
	},
	view: function (ctrl) {
		return 'count: ' + ctrl.counter;
	}
};

m.mount(document.getElementById("counter-app"), CounterApp);

</script>
